---
import Container from "../ui/Container.astro";
import ServiceCard from "../ui/ServiceCard.astro";
import Button from "../ui/Button.astro";
import { services } from "../../data/services";
import esTranslations from "../../i18n/es.json";
import enTranslations from "../../i18n/en.json";

interface Props {
    id?: string;
    lang: "es" | "en";
}

const { id, lang } = Astro.props;
const t = lang === "es" ? esTranslations : enTranslations;

// Helper to get translated services
const translatedServices = services.map((service) => ({
    ...service,
    title: service.title[lang],
    description: service.description[lang],
}));
---

<section
    id={id}
    class="services-carousel-section"
    aria-labelledby="services-title"
>
    <!-- Decorative background elements -->
    <div class="decor-blob decor-1"></div>
    <div class="decor-blob decor-2"></div>

    <Container>
        <div class="section-layout">
            <!-- Left side: Fixed content -->
            <div class="info-sidebar">
                <header class="sidebar-content">
                    <h2 id="services-title" class="section-title">
                        {t["services.title"]}
                    </h2>
                    <p class="section-subtitle">{t["services.subtitle"]}</p>

                    <div class="cta-group">
                        <Button variant="primary" href="#contacto">
                            {t["services.cta.schedule"]}
                        </Button>
                        <Button variant="secondary" href="#contacto">
                            {t["services.cta.proposal"]}
                        </Button>
                    </div>

                    <!-- Carousel Controls -->
                    <div
                        class="carousel-nav"
                        aria-label="NavegaciÃ³n de servicios"
                    >
                        <button
                            id="prev-btn"
                            class="nav-btn"
                            aria-label={t["services.nav.prev"]}
                            disabled
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                ><line x1="19" y1="12" x2="5" y2="12"
                                ></line><polyline points="12 19 5 12 12 5"
                                ></polyline></svg
                            >
                        </button>
                        <button
                            id="next-btn"
                            class="nav-btn"
                            aria-label={t["services.nav.next"]}
                        >
                            <svg
                                xmlns="http://www.w3.org/2000/svg"
                                width="24"
                                height="24"
                                viewBox="0 0 24 24"
                                fill="none"
                                stroke="currentColor"
                                stroke-width="2"
                                stroke-linecap="round"
                                stroke-linejoin="round"
                                ><line x1="5" y1="12" x2="19" y2="12"
                                ></line><polyline points="12 5 19 12 12 19"
                                ></polyline></svg
                            >
                        </button>
                    </div>
                </header>
            </div>

            <!-- Right side: Carousel -->
            <div class="carousel-container">
                <ul id="services-track" class="carousel-track">
                    {
                        translatedServices.map((service) => (
                            <ServiceCard
                                icon={service.icon}
                                title={service.title}
                                description={service.description}
                            />
                        ))
                    }
                </ul>
            </div>
        </div>
    </Container>
</section>

<script>
    const track = document.getElementById("services-track");
    const prevBtn = document.getElementById("prev-btn") as HTMLButtonElement;
    const nextBtn = document.getElementById("next-btn") as HTMLButtonElement;

    if (track && prevBtn && nextBtn) {
        const updateButtons = () => {
            const { scrollLeft, scrollWidth, clientWidth } = track;
            prevBtn.disabled = scrollLeft <= 10;
            nextBtn.disabled = scrollLeft + clientWidth >= scrollWidth - 10;
        };

        const scroll = (direction: number) => {
            const cardWidth = (track.firstElementChild as HTMLElement)
                .offsetWidth;
            const gap = parseInt(getComputedStyle(track).gap);
            const step = cardWidth + gap;

            track.scrollBy({
                left: direction * step,
                behavior: "smooth",
            });
        };

        prevBtn.addEventListener("click", () => scroll(-1));
        nextBtn.addEventListener("click", () => scroll(1));

        track.addEventListener("scroll", updateButtons);
        // Initial check
        window.addEventListener("load", updateButtons);
        window.addEventListener("resize", updateButtons);
    }
</script>

<style>
    .services-carousel-section {
        position: relative;
        padding: var(--space-24) 0;
        overflow: hidden;
        background: var(--bg);
    }

    /* Decorative blobs */
    .decor-blob {
        position: absolute;
        border-radius: 50%;
        filter: blur(80px);
        z-index: 0;
        opacity: 0.4;
        pointer-events: none;
    }

    .decor-1 {
        top: -10%;
        right: -10%;
        width: 400px;
        height: 400px;
        background: var(--primary-soft);
    }

    .decor-2 {
        bottom: -10%;
        left: -10%;
        width: 300px;
        height: 300px;
        background: var(--accent-soft);
    }

    .section-layout {
        display: grid;
        grid-template-columns: 1fr;
        gap: var(--space-12);
        position: relative;
        z-index: 1;
    }

    @media (min-width: 1024px) {
        .section-layout {
            grid-template-columns: 400px 1fr;
            align-items: center;
        }
    }

    .info-sidebar {
        padding-right: var(--space-8);
    }

    .section-title {
        font-size: clamp(2.25rem, 4vw, 3rem);
        font-weight: 800;
        line-height: 1.1;
        margin-bottom: var(--space-6);
        color: var(--text);
        letter-spacing: -0.02em;
    }

    .section-subtitle {
        font-size: var(--text-lg);
        color: var(--text-muted);
        line-height: 1.6;
        margin-bottom: var(--space-10);
    }

    .cta-group {
        display: flex;
        flex-wrap: wrap;
        gap: var(--space-4);
        margin-bottom: var(--space-12);
    }

    /* Carousel Navigation */
    .carousel-nav {
        display: flex;
        gap: var(--space-3);
    }

    .nav-btn {
        width: 48px;
        height: 48px;
        border-radius: var(--radius-full);
        border: 1px solid var(--border);
        background: var(--surface);
        color: var(--text);
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.3s ease;
    }

    .nav-btn:hover:not(:disabled) {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
        transform: scale(1.05);
    }

    .nav-btn:disabled {
        opacity: 0.3;
        cursor: not-allowed;
    }

    /* Carousel Track */
    .carousel-container {
        mask-image: linear-gradient(to right, black 85%, transparent 100%);
        margin: 0 calc(var(--space-4) * -1);
        padding: 0 var(--space-4);
    }

    @media (min-width: 1024px) {
        .carousel-container {
            margin: 0;
            padding: 0;
        }
    }

    .carousel-track {
        display: flex;
        gap: var(--space-4);
        overflow-x: auto;
        scroll-behavior: smooth;
        scroll-snap-type: x mandatory;
        padding: var(--space-4) 0;
        scrollbar-width: none; /* Firefox */
    }

    .carousel-track::-webkit-scrollbar {
        display: none; /* Chrome/Safari */
    }

    @media (min-width: 768px) {
        .carousel-track {
            gap: var(--space-6);
        }
    }

    @media (min-width: 1024px) {
        .carousel-track {
            gap: var(--space-8);
        }
    }

    /* Responsive variables for cards are set in ServiceCard.astro style */
</style>
